<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Periyava Pathuppa - Decision Maker</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            /* Background image from user */
            background-image: url('https://lh3.googleusercontent.com/pw/AP1GczOX8DsseFFGdyd50nUAzdmec-2CNEBhotlJzTMSzPSRbtDhdOAl1adaNIzL5FN1CBFGJ2H7aEtXQg9vLCbwEr5AePKfraX6UGOHlcRNOlJ27yFOlLCYjcN1pt84gjlOi1BZTW3eq9-XmX5ATOqLQf6T=w2138-h1530-s-no-gm?authuser=0');
            background-size: contain;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        
        /* Style for the highlighted choice during the "scanning" animation */
        .choice-item.highlight {
            background-color: #FDE68A; /* A respectful yellow/saffron color */
            border-color: #F59E0B;
            transform: scale(1.05);
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.1s ease-in-out;
        }
    </style>
</head>
<body class="bg-yellow-50 min-h-screen flex items-center justify-center p-4">

    <!-- Main App Card -->
    <div class="bg-white/60 backdrop-blur-sm w-full max-w-md p-6 md:p-8 rounded-2xl shadow-xl">
        
        <!-- Hero Image -->
        <div class="mb-6">
            <img src="https://lh3.googleusercontent.com/pw/AP1GczOO2b2IsvGJcBcL94dz2SFUfIk3urlEb_nZ1UXDiS3L8XQkCs8nUcEJoqdhWH4XhTkAPzM72y3Fg_71GNoQV5AV2_kAWFuTnfelwgV5CAGtBH0FkfhMoDcCPr2kyMc9Yre8nXoNYd6L5AkyRpfft73u=w2226-h1530-s-no-gm?authuser=0" 
                 alt="Maha Periyava" 
                 class="w-full h-auto rounded-xl mx-auto shadow-lg border-4 border-yellow-200">
        </div>

        <!-- Header -->
        <div class="text-center mb-6">
            <h1 class="text-3xl font-bold text-orange-800">Periyava Pathuppa</h1>
            <p class="text-gray-600 mt-1">Submit your choices for guidance.</p>
        </div>

        <!-- Input Section -->
        <div id="input-section">
            <div class="flex gap-2 mb-4">
                <input type="text" id="choice-input" 
                       placeholder="Enter a new choice..." 
                       class="flex-grow w-full px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500">
                <button id="add-choice-btn" 
                        class="px-5 py-2 bg-orange-600 text-white font-semibold rounded-lg shadow-md hover:bg-orange-700 transition-colors duration-200">
                    Add
                </button>
            </div>
        </div>

        <!-- Choices List -->
        <div id="choices-container" class="mb-6">
            <div id="choices-list" class="space-y-2 max-h-48 overflow-y-auto pr-2">
                <!-- Choices will be rendered here by JS -->
            </div>
        </div>
        
        <!-- Main Action Button -->
        <button id="ask-btn" 
                disabled
                class="w-full py-3 bg-green-700 text-white text-lg font-bold rounded-lg shadow-lg hover:bg-green-800 transition-all duration-200 disabled:bg-gray-400 disabled:shadow-none disabled:cursor-not-allowed">
            Ask Periyava
        </button>

        <!-- Result Section (Initially Hidden) -->
        <div id="result-section" class="hidden text-center mt-6">
            
            <!-- Blessing Image -->
            <img src="https://lh3.googleusercontent.com/pw/AP1GczOX8DsseFFGdyd50nUAzdmec-2CNEBhotlJzTMSzPSRbtDhdOAl1adaNIzL5FN1CBFGJ2H7aEtXQg9vLCbwEr5AePKfraX6UGOHlcRNOlJ27yFOlLCYjcN1pt84gjlOi1BZTW3eq9-XmX5ATOqLQf6T=w2138-h1530-s-no-gm?authuser=0" 
                 alt="Maha Periyava's Blessing" 
                 class="w-48 h-48 object-cover rounded-full mx-auto shadow-lg border-4 border-green-200">
            
            <h2 class="text-2xl font-semibold text-green-800 mt-4">Periyava's Guidance:</h2>
            <div id="result-text" 
                 class="text-2xl font-bold text-gray-900 p-4 border-2 border-green-600 rounded-lg bg-green-100 my-4 shadow-inner min-h-[60px] flex items-center justify-center">
                <!-- Result will be shown here -->
            </div>
            
            <!-- Result Actions -->
            <div class="flex justify-center gap-4">
                <button id="ask-again-btn" 
                        class="px-5 py-2 bg-green-700 text-white text-sm font-semibold rounded-lg shadow-md hover:bg-green-800 transition-colors duration-200">
                    <i class="fas fa-redo mr-2"></i>Ask Again
                </button>
                <button id="reset-btn" 
                        class="px-5 py-2 bg-orange-600 text-white text-sm font-semibold rounded-lg shadow-md hover:bg-orange-700 transition-colors duration-200">
                    <i class="fas fa-broom mr-2"></i>Start Over
                </button>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const choiceInput = document.getElementById('choice-input');
            const addChoiceBtn = document.getElementById('add-choice-btn');
            const choicesList = document.getElementById('choices-list');
            const askBtn = document.getElementById('ask-btn');
            const resultSection = document.getElementById('result-section');
            const resultText = document.getElementById('result-text');
            const resetBtn = document.getElementById('reset-btn');
            const askAgainBtn = document.getElementById('ask-again-btn');
            
            // Sections to toggle
            const inputSection = document.getElementById('input-section');
            const choicesContainer = document.getElementById('choices-container');
            const heroImageContainer = document.querySelector('.mb-6'); // Hero image container

            // --- State ---
            let choices = ["Choice 1", "Choice 2"];
            let editingIndex = -1; // -1 means no choice is currently being edited

            // --- Functions ---

            /**
             * Adds a new choice.
             */
            function addChoice() {
                const choiceText = choiceInput.value.trim();
                if (choiceText === '') {
                    return; // Do nothing if input is empty
                }
                choices.push(choiceText);
                choiceInput.value = ''; // Clear input
                renderChoices();
                updateAskButtonState();
                choiceInput.focus();
            }

            /**
             * Deletes a choice by its index.
             */
            function deleteChoice(index) {
                choices.splice(index, 1);
                renderChoices();
                updateAskButtonState();
            }

            /**
             * Sets up the input field for editing a choice.
             */
            function editChoice(index) {
                // If we are already editing something, save it first
                if (editingIndex !== -1 && editingIndex !== index) {
                    const currentEditInput = choicesList.querySelector('input');
                    if(currentEditInput) {
                        saveChoice(editingIndex, currentEditInput.value);
                    }
                }

                editingIndex = index;
                const choiceItem = choicesList.children[index];
                if (!choiceItem) return;

                const originalText = choices[index];
                
                // Store original content to revert on cancel
                const originalUI = choiceItem.innerHTML;

                // Create input field
                const editInput = document.createElement('input');
                editInput.type = 'text';
                editInput.classList.add('flex-grow', 'w-full', 'px-3', 'py-1', 'border', 'border-blue-500', 'rounded-md');
                
                // Handle default placeholder text
                const isDefaultText = originalText === "Choice 1" || originalText === "Choice 2";
                if (isDefaultText) {
                    editInput.value = "";
                    editInput.placeholder = originalText;
                } else {
                    editInput.value = originalText;
                }

                // Create Save button
                const saveButton = document.createElement('button');
                saveButton.innerHTML = '<i class="fas fa-save"></i>';
                saveButton.classList.add('text-green-600', 'hover:text-green-800', 'p-2', 'rounded-md', 'transition-colors');
                saveButton.onmousedown = (e) => {
                    e.preventDefault(); // Prevent blur
                    saveChoice(index, editInput.value);
                };

                // Create Cancel button
                const cancelButton = document.createElement('button');
                cancelButton.innerHTML = '<i class="fas fa-times"></i>'; // 'X' icon
                cancelButton.classList.add('text-red-600', 'hover:text-red-800', 'p-2', 'rounded-md', 'transition-colors');
                cancelButton.onmousedown = (e) => {
                    e.preventDefault(); // Prevent blur
                    editingIndex = -1;
                    revertChoiceUI(choiceItem, originalUI);
                };

                // Replace choice item content with edit UI
                choiceItem.innerHTML = '';
                choiceItem.classList.add('editing'); // Add editing flag
                choiceItem.appendChild(editInput);
                choiceItem.appendChild(saveButton);
                choiceItem.appendChild(cancelButton);

                editInput.focus();

                // Autosave on blur (clicking away)
                editInput.onblur = () => {
                    // Timeout to allow save/cancel buttons to register click
                    setTimeout(() => {
                        // Only save if we are still in editing mode (i.e., cancel wasn't clicked)
                        if (editingIndex === index) {
                            saveChoice(index, editInput.value);
                        }
                    }, 100); 
                };

                // Save on 'Enter', Cancel on 'Escape'
                editInput.onkeydown = (e) => {
                    if (e.key === 'Enter') {
                        saveChoice(index, editInput.value);
                    } else if (e.key === 'Escape') {
                        editingIndex = -1;
                        revertChoiceUI(choiceItem, originalUI);
                    }
                };
            }

            /**
             * Saves the edited choice.
             */
            function saveChoice(index, newText) {
                // Prevent double-save from blur/enter race condition
                if (editingIndex !== index || !choicesList.children[index] || !choicesList.children[index].classList.contains('editing')) {
                    return;
                }

                newText = newText.trim();
                const isDefaultText = choices[index] === "Choice 1" || choices[index] === "Choice 2";
                
                if (newText === '' && !isDefaultText) {
                    // If user blanks a custom choice, delete it
                    deleteChoice(index);
                } else if (newText === '' && isDefaultText) {
                    // If user blanks a default choice, just revert
                    revertChoiceUI(choicesList.children[index], createChoiceUI(choices[index], index));
                } else {
                    // Save the new text
                    choices[index] = newText;
                    revertChoiceUI(choicesList.children[index], createChoiceUI(newText, index));
                }
                editingIndex = -1;
                updateAskButtonState();
            }

            /**
             * Reverts the choice item back to its original display UI.
             */
            function revertChoiceUI(choiceItem, newHTML) {
                if(choiceItem) {
                    choiceItem.innerHTML = newHTML;
                    choiceItem.classList.remove('editing');
                    // Re-attach event listeners
                    const textSpan = choiceItem.querySelector('.choice-text');
                    const editButton = choiceItem.querySelector('.edit-btn');
                    const deleteButton = choiceItem.querySelector('.delete-btn');
                    
                    const index = Array.from(choicesList.children).indexOf(choiceItem);

                    if(textSpan) textSpan.onclick = () => editChoice(index);
                    if(editButton) editButton.onclick = () => editChoice(index);
                    if(deleteButton) deleteButton.onclick = () => deleteChoice(index);
                }
            }
            
            /**
             * Creates the inner HTML for a standard choice item.
             */
            function createChoiceUI(choice, index) {
                // There was a typo here: 'classf' instead of 'class'
                return `
                    <span class="choice-text flex-grow cursor-pointer">${choice}</span>
                    <div class="flex gap-2">
                        <button class="edit-btn text-blue-600 hover:text-blue-800 p-1 rounded-md transition-colors">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="delete-btn text-red-600 hover:text-red-800 p-1 rounded-md transition-colors">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                `;
            }

            /**
             * Re-renders the list of choices on the screen.
             */
            function renderChoices() {
                choicesList.innerHTML = ''; // Clear existing list
                
                if (editingIndex !== -1) {
                    // If editing, make sure to save first (or cancel)
                    const currentEditInput = document.querySelector('.choice-item.editing input');
                    if (currentEditInput) {
                        saveChoice(editingIndex, currentEditInput.value);
                    }
                    editingIndex = -1;
                }

                choices.forEach((choice, index) => {
                    const choiceElement = document.createElement('div');
                    choiceElement.classList.add('choice-item', 'bg-gray-100', 'rounded-lg', 'p-3', 'text-gray-800', 'font-medium', 'transition-all', 'duration-100', 'border-2', 'border-transparent', 'flex', 'items-center', 'justify-between');
                    
                    choiceElement.innerHTML = createChoiceUI(choice, index);
                    
                    // Attach listeners
                    choiceElement.querySelector('.choice-text').onclick = () => editChoice(index);
                    choiceElement.querySelector('.edit-btn').onclick = () => editChoice(index);
                    choiceElement.querySelector('.delete-btn').onclick = () => deleteChoice(index);

                    choicesList.appendChild(choiceElement);
                });
            }

            /**
             * Enables or disables the "Ask" button based on the number of choices.
             */
            function updateAskButtonState() {
                askBtn.disabled = choices.length < 2;
            }

            /**
             * Starts the decision-making animation (new scanning version).
             */
            function startDecision() {
                // Disable controls
                askBtn.disabled = true;
                addChoiceBtn.disabled = true;
                choiceInput.disabled = true;
                document.querySelectorAll('.choice-item button').forEach(btn => btn.disabled = true);
                document.querySelectorAll('.choice-item .choice-text').forEach(span => span.style.cursor = 'default');

                const totalDuration = 2500; // Total "thinking" time in ms
                const intervalTime = 100; // Time between highlight moves
                let elapsedTime = 0;
                let direction = 1; // 1 = down, -1 = up
                let currentIndex = 0;

                const items = document.querySelectorAll('#choices-list .choice-item');
                if (items.length === 0) {
                    resetApp(); // Should not happen, but as a safeguard
                    return;
                }

                const animationInterval = setInterval(() => {
                    elapsedTime += intervalTime;

                    // Remove highlight from all
                    items.forEach(item => item.classList.remove('highlight'));

                    // Add highlight to current
                    if (items[currentIndex]) {
                        items[currentIndex].classList.add('highlight');
                    }

                    // Move index
                    currentIndex += direction;

                    // Reverse direction if at ends
                    if (currentIndex >= items.length) {
                        currentIndex = items.length - 2;
                        direction = -1;
                    } else if (currentIndex < 0) {
                        currentIndex = 1;
                        direction = 1;
                    }

                    // Stop animation
                    if (elapsedTime >= totalDuration) {
                        clearInterval(animationInterval);
                        
                        // Settle on a final choice
                        const finalChoiceIndex = pickRandomChoiceIndex();
                        const finalChoice = choices[finalChoiceIndex];
                        
                        // Highlight the final choice
                        items.forEach(item => item.classList.remove('highlight'));
                        if (items[finalChoiceIndex]) {
                            items[finalChoiceIndex].classList.add('highlight');
                        }

                        // Wait a moment on the final highlight before showing result
                        setTimeout(() => {
                            showResult(finalChoice);
                        }, 500);
                    }
                }, intervalTime);
            }

            /**
             * Returns a random index from the choices array.
             */
            function pickRandomChoiceIndex() {
                return Math.floor(Math.random() * choices.length);
            }

            /**
             * Displays the final chosen result.
             */
            function showResult(finalChoice) {
                // Hide input and choice sections
                inputSection.classList.add('hidden');
                choicesContainer.classList.add('hidden');
                askBtn.classList.add('hidden');
                heroImageContainer.classList.add('hidden'); // Hide hero image

                // Show result
                resultText.textContent = finalChoice;
                resultSection.classList.remove('hidden');

                // Re-enable "Ask Again" button
                askAgainBtn.disabled = false;
            }
            
            /**
             * Resets the app to the decision state (with same choices).
             */
            function askAgain() {
                // Hide result section
                resultSection.classList.add('hidden');
                resultText.textContent = '';

                // Show input and choice sections
                inputSection.classList.remove('hidden');
                choicesContainer.classList.remove('hidden');
                askBtn.classList.remove('hidden');
                heroImageContainer.classList.remove('hidden'); // Show hero image
                
                // Re-enable controls
                addChoiceBtn.disabled = false;
                choiceInput.disabled = false;
                
                // Redraw choices to re-enable buttons
                renderChoices();
                updateAskButtonState();
                
                // Remove any lingering highlights
                const items = document.querySelectorAll('#choices-list .choice-item');
                items.forEach(item => item.classList.remove('highlight'));
            }

            /**
             * Resets the app to its initial state.
             */
            function resetApp() {
                choices = ["Choice 1", "Choice 2"];
                editingIndex = -1; 
                choiceInput.value = '';

                renderChoices();
                updateAskButtonState();

                // Hide result section
                resultSection.classList.add('hidden');
                resultText.textContent = '';

                // Show input and choice sections
                inputSection.classList.remove('hidden');
                choicesContainer.classList.remove('hidden');
                askBtn.classList.remove('hidden');
                heroImageContainer.classList.remove('hidden'); // Show hero image

                // Re-enable controls
                addChoiceBtn.disabled = false;
                choiceInput.disabled = false;
            }

            // --- Event Listeners ---
            addChoiceBtn.addEventListener('click', addChoice);
            choiceInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') {
                    addChoice();
                }
            });
            askBtn.addEventListener('click', startDecision);
            resetBtn.addEventListener('click', resetApp);
            askAgainBtn.addEventListener('click', askAgain);

            // --- Initial State Setup ---
            renderChoices();
            updateAskButtonState();
        });
    </script>
</body>
</html>
