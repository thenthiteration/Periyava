<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Periyava Pathuppa - Decision Maker</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            /* Background image from user */
            background-image: url('https://lh3.googleusercontent.com/pw/AP1GczOX8DsseFFGdyd50nUAzdmec-2CNEBhotlJzTMSzPSRbtDhdOAl1adaNIzL5FN1CBFGJ2H7aEtXQg9vLCbwEr5AePKfraX6UGOHlcRNOlJ27yFOlLCYjcN1pt84gjlOi1BZTW3eq9-XmX5ATOqLQf6T=w2138-h1530-s-no-gm?authuser=0');
            background-size: contain;
            background-position: center center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
        
        /* Smooth base state for items */
        .choice-item {
            transition: background-color 0.2s, border-color 0.2s, box-shadow 0.3s;
        }

        /* Highlight state during scanning - Focus on color, not size, to prevent "flicker" */
        .choice-item.highlight {
            background-color: #FEF3C7; /* Light amber/saffron */
            border-color: #F59E0B;
            box-shadow: 0 0 15px rgba(245, 158, 11, 0.2);
            z-index: 10;
        }

        /* Final selected state - Color and shadow only (pop/scale effect removed) */
        .choice-item.selected-final {
            background-color: #FDE68A;
            border-color: #F59E0B;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        /* Custom Scrollbar for the choices list */
        #choices-list::-webkit-scrollbar {
            width: 6px;
        }
        #choices-list::-webkit-scrollbar-track {
            background: transparent;
        }
        #choices-list::-webkit-scrollbar-thumb {
            background: #e2e8f0;
            border-radius: 10px;
        }
    </style>
</head>
<body class="bg-yellow-50 min-h-screen flex items-center justify-center p-4">

    <!-- Main App Card -->
    <div class="bg-white/60 backdrop-blur-sm w-full max-w-md p-6 md:p-8 rounded-2xl shadow-xl">
        
        <!-- Hero Image (Home Screen) -->
        <div class="mb-6 hero-image-container">
            <img src="https://lh3.googleusercontent.com/pw/AP1GczOO2b2IsvGJcBcL94dz2SFUfIk3urlEb_nZ1UXDiS3L8XQkCs8nUcEJoqdhWH4XhTkAPzM72y3Fg_71GNoQV5AV2_kAWFuTnfelwgV5CAGtBH0FkfhMoDcCPr2kyMc9Yre8nXoNYd6L5AkyRpfft73u=w2226-h1530-s-no-gm?authuser=0" 
                 alt="Maha Periyava" 
                 class="w-full h-auto rounded-xl mx-auto shadow-lg border-4 border-yellow-200">
        </div>

        <!-- Header -->
        <div class="text-center mb-6" id="header-section">
            <h1 class="text-3xl font-bold text-orange-800">Periyava Pathuppa</h1>
            <p class="text-gray-600 mt-1">Submit your choices for guidance.</p>
        </div>

        <!-- Question Input Section -->
        <div id="question-section" class="mb-6">
            <label for="question-input" class="block text-sm font-semibold text-orange-900 mb-1">Your Question:</label>
            <input type="text" id="question-input" 
                   placeholder="e.g., Which path should I choose today?" 
                   class="w-full px-4 py-2 border border-orange-200 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white/50">
        </div>

        <!-- Choices Input Section -->
        <div id="input-section">
            <label class="block text-sm font-semibold text-orange-900 mb-1">Add Options:</label>
            <div class="flex gap-2 mb-4">
                <input type="text" id="choice-input" 
                       placeholder="Enter an option..." 
                       class="flex-grow px-4 py-2 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-orange-500 focus:border-orange-500 bg-white/50">
                <button id="add-choice-btn" 
                        class="px-5 py-2 bg-orange-600 text-white font-semibold rounded-lg shadow-md hover:bg-orange-700 transition-colors duration-200">
                    Add
                </button>
            </div>
        </div>

        <!-- Choices List -->
        <div id="choices-container" class="mb-6">
            <div id="choices-list" class="space-y-2 max-h-48 overflow-y-auto pr-2">
                <!-- Choices will be rendered here by JS -->
            </div>
        </div>
        
        <!-- Main Action Button -->
        <button id="ask-btn" 
                disabled
                class="w-full py-3 bg-green-700 text-white text-lg font-bold rounded-lg shadow-lg hover:bg-green-800 transition-all duration-200 disabled:bg-gray-400 disabled:shadow-none disabled:cursor-not-allowed">
            Ask Periyava
        </button>

        <!-- Result Section (Initially Hidden) -->
        <div id="result-section" class="hidden text-center mt-2">
            
            <!-- Blessing Image (Rectangle style matching home screen) -->
            <img src="https://lh3.googleusercontent.com/pw/AP1GczOO2b2IsvGJcBcL94dz2SFUfIk3urlEb_nZ1UXDiS3L8XQkCs8nUcEJoqdhWH4XhTkAPzM72y3Fg_71GNoQV5AV2_kAWFuTnfelwgV5CAGtBH0FkfhMoDcCPr2kyMc9Yre8nXoNYd6L5AkyRpfft73u=w2226-h1530-s-no-gm?authuser=0" 
                 alt="Maha Periyava's Blessing" 
                 class="w-full h-auto rounded-xl mx-auto shadow-2xl border-4 border-green-200">
            
            <div id="display-question-container" class="mt-6 px-4">
                <p class="text-xs uppercase tracking-widest text-orange-800 font-bold opacity-75">Your Question</p>
                <p id="display-question-text" class="text-xl italic text-gray-800 font-medium"></p>
            </div>

            <h2 class="text-2xl font-semibold text-green-800 mt-6 tracking-tight">Periyava's Guidance:</h2>
            <div id="result-text" 
                 class="text-2xl font-bold text-gray-900 p-4 border-2 border-green-600 rounded-lg bg-green-100 my-4 shadow-inner min-h-[60px] flex items-center justify-center">
                <!-- Result will be shown here -->
            </div>
            
            <!-- Result Actions -->
            <div class="flex justify-center gap-4 mt-6">
                <button id="ask-again-btn" 
                        class="px-5 py-2 bg-green-700 text-white text-sm font-semibold rounded-lg shadow-md hover:bg-green-800 transition-colors duration-200">
                    <i class="fas fa-redo mr-2"></i>Ask Again
                </button>
                <button id="reset-btn" 
                        class="px-5 py-2 bg-orange-600 text-white text-sm font-semibold rounded-lg shadow-md hover:bg-orange-700 transition-colors duration-200">
                    <i class="fas fa-broom mr-2"></i>Start Over
                </button>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const questionInput = document.getElementById('question-input');
            const choiceInput = document.getElementById('choice-input');
            const addChoiceBtn = document.getElementById('add-choice-btn');
            const choicesList = document.getElementById('choices-list');
            const askBtn = document.getElementById('ask-btn');
            const resultSection = document.getElementById('result-section');
            const resultText = document.getElementById('result-text');
            const displayQuestionText = document.getElementById('display-question-text');
            const resetBtn = document.getElementById('reset-btn');
            const askAgainBtn = document.getElementById('ask-again-btn');
            
            // Sections to toggle
            const headerSection = document.getElementById('header-section');
            const questionSection = document.getElementById('question-section');
            const inputSection = document.getElementById('input-section');
            const choicesContainer = document.getElementById('choices-container');
            const heroImageContainer = document.querySelector('.hero-image-container');

            // --- State ---
            let choices = ["Choice 1", "Choice 2"];
            let editingIndex = -1; 

            // --- Functions ---

            function addChoice() {
                const choiceText = choiceInput.value.trim();
                if (choiceText === '') return;
                choices.push(choiceText);
                choiceInput.value = '';
                renderChoices();
                updateAskButtonState();
                choiceInput.focus();
            }

            function deleteChoice(index) {
                choices.splice(index, 1);
                renderChoices();
                updateAskButtonState();
            }

            function editChoice(index) {
                if (editingIndex !== -1 && editingIndex !== index) {
                    const currentEditInput = choicesList.querySelector('input');
                    if(currentEditInput) saveChoice(editingIndex, currentEditInput.value);
                }

                editingIndex = index;
                const choiceItem = choicesList.children[index];
                if (!choiceItem) return;

                const originalText = choices[index];
                const originalUI = choiceItem.innerHTML;

                const editInput = document.createElement('input');
                editInput.type = 'text';
                editInput.classList.add('flex-grow', 'w-full', 'px-3', 'py-1', 'border', 'border-blue-500', 'rounded-md', 'bg-white');
                
                const isDefaultText = originalText === "Choice 1" || originalText === "Choice 2";
                if (isDefaultText) {
                    editInput.value = "";
                    editInput.placeholder = originalText;
                } else {
                    editInput.value = originalText;
                }

                const saveButton = document.createElement('button');
                saveButton.innerHTML = '<i class="fas fa-save"></i>';
                saveButton.classList.add('text-green-600', 'hover:text-green-800', 'p-2', 'rounded-md');
                saveButton.onmousedown = (e) => {
                    e.preventDefault();
                    saveChoice(index, editInput.value);
                };

                const cancelButton = document.createElement('button');
                cancelButton.innerHTML = '<i class="fas fa-times"></i>';
                cancelButton.classList.add('text-red-600', 'hover:text-red-800', 'p-2', 'rounded-md');
                cancelButton.onmousedown = (e) => {
                    e.preventDefault();
                    editingIndex = -1;
                    revertChoiceUI(choiceItem, originalUI);
                };

                choiceItem.innerHTML = '';
                choiceItem.classList.add('editing');
                choiceItem.appendChild(editInput);
                choiceItem.appendChild(saveButton);
                choiceItem.appendChild(cancelButton);

                editInput.focus();

                editInput.onblur = () => {
                    setTimeout(() => {
                        if (editingIndex === index) saveChoice(index, editInput.value);
                    }, 150); 
                };

                editInput.onkeydown = (e) => {
                    if (e.key === 'Enter') saveChoice(index, editInput.value);
                    else if (e.key === 'Escape') {
                        editingIndex = -1;
                        revertChoiceUI(choiceItem, originalUI);
                    }
                };
            }

            function saveChoice(index, newText) {
                if (editingIndex !== index || !choicesList.children[index] || !choicesList.children[index].classList.contains('editing')) return;

                newText = newText.trim();
                const isDefaultText = choices[index] === "Choice 1" || choices[index] === "Choice 2";
                
                if (newText === '' && !isDefaultText) {
                    deleteChoice(index);
                } else if (newText === '' && isDefaultText) {
                    revertChoiceUI(choicesList.children[index], createChoiceUI(choices[index], index));
                } else {
                    choices[index] = newText;
                    revertChoiceUI(choicesList.children[index], createChoiceUI(newText, index));
                }
                editingIndex = -1;
                updateAskButtonState();
            }

            function revertChoiceUI(choiceItem, newHTML) {
                if(choiceItem) {
                    choiceItem.innerHTML = newHTML;
                    choiceItem.classList.remove('editing');
                    const textSpan = choiceItem.querySelector('.choice-text');
                    const editButton = choiceItem.querySelector('.edit-btn');
                    const deleteButton = choiceItem.querySelector('.delete-btn');
                    const index = Array.from(choicesList.children).indexOf(choiceItem);
                    if(textSpan) textSpan.onclick = () => editChoice(index);
                    if(editButton) editButton.onclick = () => editChoice(index);
                    if(deleteButton) deleteButton.onclick = () => deleteChoice(index);
                }
            }
            
            function createChoiceUI(choice, index) {
                return `
                    <span class="choice-text flex-grow cursor-pointer">${choice}</span>
                    <div class="flex gap-2">
                        <button class="edit-btn text-blue-600 hover:text-blue-800 p-1 rounded-md transition-colors">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="delete-btn text-red-600 hover:text-red-800 p-1 rounded-md transition-colors">
                            <i class="fas fa-trash-alt"></i>
                        </button>
                    </div>
                `;
            }

            function renderChoices() {
                choicesList.innerHTML = '';
                if (editingIndex !== -1) {
                    const currentEditInput = document.querySelector('.choice-item.editing input');
                    if (currentEditInput) saveChoice(editingIndex, currentEditInput.value);
                    editingIndex = -1;
                }
                choices.forEach((choice, index) => {
                    const choiceElement = document.createElement('div');
                    choiceElement.classList.add('choice-item', 'bg-gray-100/80', 'rounded-lg', 'p-3', 'text-gray-800', 'font-medium', 'transition-all', 'duration-100', 'border-2', 'border-transparent', 'flex', 'items-center', 'justify-between');
                    choiceElement.innerHTML = createChoiceUI(choice, index);
                    choiceElement.querySelector('.choice-text').onclick = () => editChoice(index);
                    choiceElement.querySelector('.edit-btn').onclick = () => editChoice(index);
                    choiceElement.querySelector('.delete-btn').onclick = () => deleteChoice(index);
                    choicesList.appendChild(choiceElement);
                });
            }

            function updateAskButtonState() {
                askBtn.disabled = choices.length < 2;
            }

            function startDecision() {
                // Disable all interactions
                askBtn.disabled = true;
                addChoiceBtn.disabled = true;
                choiceInput.disabled = true;
                questionInput.disabled = true;
                document.querySelectorAll('.choice-item button').forEach(btn => btn.disabled = true);
                document.querySelectorAll('.choice-item .choice-text').forEach(span => span.style.cursor = 'default');

                const totalDuration = 2500; 
                const intervalTime = 120; // Slightly slower for smoothness
                let elapsedTime = 0;
                let direction = 1; 
                let currentIndex = 0;

                const items = document.querySelectorAll('#choices-list .choice-item');
                if (items.length === 0) return;

                const animationInterval = setInterval(() => {
                    elapsedTime += intervalTime;
                    
                    // Efficiently update highlights
                    items.forEach((item, idx) => {
                        if (idx === currentIndex) {
                            item.classList.add('highlight');
                        } else {
                            item.classList.remove('highlight');
                        }
                    });

                    // Manage direction
                    currentIndex += direction;
                    if (currentIndex >= items.length) {
                        currentIndex = items.length - 2;
                        direction = -1;
                    } else if (currentIndex < 0) {
                        currentIndex = Math.min(1, items.length - 1);
                        direction = 1;
                    }

                    // End animation
                    if (elapsedTime >= totalDuration) {
                        clearInterval(animationInterval);
                        
                        // Pick final result
                        const finalChoiceIndex = Math.floor(Math.random() * choices.length);
                        const finalChoice = choices[finalChoiceIndex];
                        
                        // Clear all highlights
                        items.forEach(item => item.classList.remove('highlight'));
                        
                        // Emphasize the final one with color (pop effect removed)
                        if (items[finalChoiceIndex]) {
                            items[finalChoiceIndex].classList.add('selected-final');
                        }

                        // Delay transition to result screen to let user see the selection
                        setTimeout(() => showResult(finalChoice), 800);
                    }
                }, intervalTime);
            }

            function showResult(finalChoice) {
                headerSection.classList.add('hidden');
                questionSection.classList.add('hidden');
                inputSection.classList.add('hidden');
                choicesContainer.classList.add('hidden');
                askBtn.classList.add('hidden');
                heroImageContainer.classList.add('hidden');

                const userQuestion = questionInput.value.trim();
                displayQuestionText.textContent = userQuestion || "Guidance sought for your path.";
                resultText.textContent = finalChoice;
                resultSection.classList.remove('hidden');
            }
            
            function askAgain() {
                resultSection.classList.add('hidden');
                resultText.textContent = '';
                headerSection.classList.remove('hidden');
                questionSection.classList.remove('hidden');
                inputSection.classList.remove('hidden');
                choicesContainer.classList.remove('hidden');
                askBtn.classList.remove('hidden');
                heroImageContainer.classList.remove('hidden');
                
                addChoiceBtn.disabled = false;
                choiceInput.disabled = false;
                questionInput.disabled = false;
                renderChoices();
                updateAskButtonState();
            }

            function resetApp() {
                choices = ["Choice 1", "Choice 2"];
                editingIndex = -1; 
                choiceInput.value = '';
                questionInput.value = '';
                askAgain();
            }

            // --- Event Listeners ---
            addChoiceBtn.addEventListener('click', addChoice);
            choiceInput.addEventListener('keyup', (e) => {
                if (e.key === 'Enter') addChoice();
            });
            askBtn.addEventListener('click', startDecision);
            resetBtn.addEventListener('click', resetApp);
            askAgainBtn.addEventListener('click', askAgain);

            renderChoices();
            updateAskButtonState();
        });
    </script>
</body>
</html>
